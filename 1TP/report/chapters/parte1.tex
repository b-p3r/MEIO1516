\chapter{Parte 1}
\label{cap:p1}

\section{Análise do problema}

\subsection{Dados}
O objetivo desta parte é a análise de um sistema de atendimento a clientes de um
hipermercado, onde se possui alguns dados relativos à afluência dos clientes às
caixas e ao volume do compras por cliente. Obteve-se dados referentes usando
a aplicação fornecida para o efeito (Apêndice~\ref{appendix:a}
e Apêndice~\ref{appendix:b}), com o número de aluno 72628. Além deste
dados, possui-se a estimativa do tempo de serviço de cada caixa, representada
através da formula $s=25.5+3.1n$, onde $n$ é o número de unidades de produtos
por cliente, sendo a grandeza de medida deste tempo de atendimento o segundo. 

\subsection{Objetivo}

Pretende-se dimensionar o serviço de atendimento de clientes, determinando
o número de caixas necessárias para dois tipos de caixa: caixa com limite máximo
de compras até 10 produtos e caixas com o limite mínimo de compras de 10
produtos. Este dimensionamento tem que ser tal, que o tempo de espera de cada
cliente no tipo de caixa até 10 unidades de artigos seja 1.5 minutos e o no
outro tipo seja de 3 minutos.

Com o exposto, em que existem tempos de espera antes de um atendimento numa
caixa, e onde temos um tempo de serviço, podemos considerar que o sistema pode
ser modelado em termos de filas de espera, onde as caixas serão os respetivos
servidores. No entanto é necessário saber que tipo de fila de espera poderá
modelar o sistema. Como, relativamente ao sistema, só dispomos de informação
relativa a tempos de serviço e tempos de chegada e não sabemos certos aspetos do
processo de chegada, disciplina da fila, nº de filas e mecanismo de serviço
e número máximo de clientes por fila, assume-se, com base em obervações
anteriores de hipermercados, o seguinte:

\begin{itemize}

	\item \emph{Processo de chegada};

Desconhece-se o número de cliente potenciais, se é infinito ou limitado.
Assume-se que o número de potenciais clientes é ilimitado. De igual modo,
desconhece-se se os clientes podem chegar em grupo ou não, no entanto, assume-se
que o número de clientes que chegam simultaneamente é único. Não se sabe, se
a taxa média de chegadas é constante, variável no tempo ou é influenciada pelo
estado da fila, todavia assume-se que é constante. Desconhece-se se existe
influência externa, pelo que se assume que não existe. No entanto, existem dados
relativos às chegadas de clientes que é necessário confirmar a distribuição
estatística.
	
	\item \emph{Disciplina da fila};

Relativamente à disciplina das filas, afirma-se que não pode ser
\emph{LIFO}, no entanto não se sabe de possíveis modalidades nas filas tal
como filas prioritárias ou \emph{pre-emptive}. Assim, assume-se que
a disciplina das filas é \emph{FIFO}.   

	\item \emph{Nº de filas};

Afirma-se que existe uma fila para cada servidor, dado que cada fila
é independente das outras. 

	\item \emph{Mecanismo de serviço};

Não se sabe se existem modalidades de serviço em que clientes sejam atendidos
em grupo. Assim assume-se que cada cliente é atendido de cada vez. De igual
modo, não se sabe se a disponibilidade de serviço, assumindo-se que o serviço
está sempre disponível, e também, desconhece-se se a taxa média de serviço
é variável no tempo ou constante, pelo que se assume que a taxa média de serviço
é constante. Tal como no processo de chegada, existem dados relativos aos tempos
de serviço, pelo que é necessário averiguar a distribuição. Relativamente, ao
número de servidores, assume-se que pode haver um ou vários, dependendo do tipo
de caixa, uma vez que se desconhece-se se esse número pode variar.

	\item \emph{Número máximo de clientes por fila};

Desconhece-se se existe alguma modalidade, na qual existe um limite de clientes
numa fila, pelo que se assume que o número de clientes numa fila é ilimitado.

\end{itemize}

Estas assunções podem ter implicações nos resultados do sistema e serão
explicadas na secção seguinte.\


\subsection{Cálculos}

Para a obtenção de uma solução ótima do problema é necessário, verificar
a distribuição dos tempos de chegada, bem como dos tempos de serviço.  Note-se
que estes tempo, pelo que se pode observar nos dados não são constantes, pelo
que podem ser um de duas hipóteses: ou são exponenciais negativos ou genérico.
Mesmo que uma das distribuições se mostrem genéricas, ou melhor, que não seguem
uma distribuição exponencial negativa, usar-se-á a exponencial negativa como
simplificação. Para o caso da distribuição do tempo de serviço assumir-se-á que
segue uma distribuição exponencial negativa, sem efetuar um teste de \emph{bom
ajuste} (ver Subsecção\ref{subsection:td}), uma vez que para o fazer seria
necessário calcular o valor esperado de observações de cada categoria, o que
acrescia bastante a complexidade do problema, sem garantias de obtenção de uma
solução correta.

De igual modo, pede-se que se faça a distinção entre servidores: caixas até 10
itens e caixa mais de 10 itens. Cada um deste tipos de servidor tem um tempo
associado, como já foi descrito anteriormente, pelo que é necessário dividir
a amostra dada com os valores do número de compras por cliente, e a sua
frequência, em dois grupos de dados. A Tabela~\ref{tab:tabela5}, no
Apêndice~\ref{appendix:c1} é referente às caixas até 10 unidades,
e a Tabela~\ref{tab:tabela6} é referente às caixas para mais de 10 unidades.





\subsection{Cálculo do taxa de atendimento para os dois tipos de serviço}

Como temos dois grupos de dados, com determinados requisitos em relação ao
tempo, necessitámos de obter a taxa média de atendimento ($\mu$) para cada tipo
de caixa. O procedimento adotado consistiu na obtenção do valor médio do tempo
de serviço ($\tilde{s}$) para obter cada um dos $\mu's$. Assim, recorreu-se
à seguinte fórmula para achar o valor médio:

\begin{equation}
	\tilde{s}=\dfrac{1}{N}\sum^{N}_{i=1} (t_i.f_i)
	\label{eq:equation1}
\end{equation}

Note-se que $N$ é número total de observações, $t_i$ é o tempo obtido através
da formula $s=25.5+3.1n$, onde $n$ é o número de compras e, $f_i$ é a frequência
que $n$, ou $t_i$, ocorre. Assim obtemos a Tabela~\ref{tab:tabela5}
e Tabela~\ref{tab:tabela6}, que figuram no Apêndice~\ref{appendix:c1}, onde a primeira coluna corresponde ao número de
artigos por compra $n$, a segunda coluna a frequência em que a compra ocorre,
a terceira coluna é o valor de $t_i \times f_i$. Com estes valores, aplicando
a Equação~\ref{eq:equation1}, por partes, obtemos os seguintes valores:

\begin{itemize}
	\item \emph{Para até 10 artigos;}
		\begin{itemize}
			\item Amostra de 864 clientes;
			\item Tempo total de atendimento 37569.2 segundos;
			\item Tempo médio de atendimento $\tilde{s}=43.4829$ segundos;
			\item Taxa de atendimento $\mu=\dfrac{1}{\tilde{s}}=0.0230$
				clientes/segundo;
			\item Taxa de atendimento $\mu=\dfrac{1}{\tilde{s}} \times 60 \times
				60=82.7912$ clientes/hora;
		\end{itemize}

	\item \emph{Para mais de 10 artigos;}
		\begin{itemize}
			\item Amostra de 9733 clientes;
			\item Tempo total de atendimento 1560874.1 segundos;
			\item Tempo médio de atendimento $\tilde{s}=160,3693$ segundos;
			\item Taxa de atendimento $\mu=\dfrac{1}{\tilde{s}}=0.0062$
				clientes/segundo;
			\item Taxa de atendimento $\mu=\dfrac{1}{\tilde{s}} \times 60 \times
				60=22.4482$ clientes/hora;
		\end{itemize}
\end{itemize}


\subsection{Cálculo do taxa de chegada às caixas}

Como não dispomos de informação suficiente, sobre a taxa de chegada ($\lambda$)
a cada um dos tipos de caixa, temos que simplificar e usar $\lambda$ para os
dois tipos de serviço.

Para obter $\tilde{\lambda}$ para o número de observações existentes, usou-se
a seguinte fórmula:

\begin{equation}
	\tilde{\lambda}	= \dfrac{m}{\sum^{m}_{i=1} t_i}
	\label{eq:equation2}
\end{equation}

Na Equação~\ref{eq:equation2}, $m$ é o número total de observações e $t_i$
é o tempo marcado da ocorrência.

Assim, para os dados relativos à taxa de chegada fornecidos
e, aplicando a Equação~\ref{eq:equation2} por partes, temos que:

\begin{itemize}
	\item $m=1000$ observações; 
	\item Total da soma dos intervalos de tempo entre chegadas $\sum^{m}_{i=1}
		t_i = 17254,5$ segundos;
	\item $\tilde{\lambda} = 0,0580$ chegadas/segundo;
	\item $\tilde{\lambda} = \dfrac{m}{\sum^{m}_{i=1} t_i} \times 60 \times 60
		= 208,6412$ chegadas/hora;
\end{itemize}

\subsection{Teste às distribuições}
\label{subsection:td}
Para testar o $\tilde{\lambda}$ e TODO o é necessário recorrer ao teste do \emph{bom
ajuste} ou $\chi^2$. Este processo consiste, em dividir a amostra em \emph{k}
categorias, correspondentes a intervalos, onde cada uma delas possui uma
frequência de ocorrência, i.e.\, o número de $t_i$ em segundos que cai em cada
uma das categorias. Para o cálculo da estatística de teste, para além dos
valores das frequências $o_j$ observadas, temos o número esperado de ocorrências
$e_j$. A estatística de teste pode ser calculada a partir, da seguinte fórmula:

\begin{equation}
	\chi^{2}(obs) = \sum^{k}_{j=1}\dfrac{(o_j-e_j)^2}{e_j}	
	\label{eq:equation3}
\end{equation}


O $k$ é o número de categorias, e $\chi^{2}(obs)$ deverá seguir uma distribuição
$\chi^2$ com $k-r-1$ graus de liberdade, onde $r=1$ e $\alpha=0.05$.

Assim, se $\chi^{2}(obs) \leq \chi^{2}_{k-r-1}$ pode-se admitir que os $t_i$
representam uma amostra da distribuição
$f(t)=\tilde{\lambda}e^{-\tilde{\lambda}t}$. Caso contrário, não será razoável
admitir essa consideração.

Deste forma, procedeu-se à implementação do processo. Dividiu-se a amostra em
5 categorias, tais que, a probabilidade de cair em cada uma delas é igual. Logo,
5 categorias indicam uma probabilidade de 0.2 para cada uma delas.
Consequentemente, o número esperado $e_j=0.2\times 1000 \iff e_j=200$, onde 1000
é o número total de observações.\

Para calcular os limites de fronteira das categorias necessitou-se de recorrer
à função acumulada $F(t)=P(A\leq t)=1-e^{-\tilde{\lambda}t}$, onde
$\tilde{\lambda}=0,0580$, já previamente mencionado.

Temos que $F(l_1) = 0.2$, $F(l_2) = 0.4$, $F(l_3) = 0.6$ e $F(l_4) = 0.8$.
Resolvendo em ordem a $l_i~\forall~i \in \{1,2,3,4\}$ temos a seguinte equação:
\begin{equation}
l_i=-\dfrac{1}{0,0580}\times \ln(1-F(l_i)), \forall~i \in \{1,2,3,4\}
	\label{eq:equation4}
\end{equation}

Assim, obtemos os valores fronteira que figuram na Tabela~\ref{tab:tabela3}.

\input{./report/table/tabela3}

\newpage 

Para cada categoria, os intervalos ficaram como figura na
Tabela~\ref{tab:tabela4}.


\input{./report/table/tabela4}

As parcelas na Tabela~\ref{tab:tabela41}, correspondem ao valor obtido para cada
$o_j$ na Equação~\ref{eq:equation3}. O total figura na última linha
e é a estatística de teste. 

\input{./report/table/tabela41}

Para $\alpha=0.05$, com $k-r-1=3$ graus de liberdade, temos que o valor tabelado
do $\chi^2_3=7.81$. Como $\chi^2_3>\chi^2(obs)$ aceita-se que os $t_i$ seguem um
distribuição exponencial negativa, com um nível de confiança de 95\%.


\newpage
\subsection{Resultados obtidos}

Os resultados foram obtidos através da aplicação \emph{web}
\verb|supositorio.com|, iterando os valores dos servidores até o tempo de espera
do cliente ser menor ou igual 3 minutos para caixas para mais de 10 compras
e 1.5 minutos para caixas até 10 unidades. Note-se que se tentou aproximar
o máximo o valor de \emph{Lq} para estes valores. 

\subsubsection{Para até 10 unidades}
Para até 10 unidades, tentou-se com 2, 3 e 4 servidores, para os valores de
$\lambda$ e $\mu$ indicados acima. Para 2 servidores, sendo $\rho = \frac{\lambda}{S \mu}$,
temos que $\rho=1.62$ o que é maior que 1, logo a fila cresceria infinitamente.
Para 3 servidores, temos que $\rho=0.84$, $L=6.2887$ clientes no sistema,
e $Lq=3.767$ clientes na fila, sendo que
a medida que interessa, tempo de espera na fila, $Wq=1.0825$ minutos. 
Para 4 servidores, temos que $\rho=0.63$, $L=3.0799$, e $Lq=0.5582$ minutos, sendo que
a medida que interessa $Wq=0.1604$ minutos. 


\subsubsection{Para mais de 10 unidades}

Para mais de 10 unidades, tentou-se com 9, 10, 11 e 12 servidores, para os valores de
$\lambda$ e $\mu$ indicados acima. Para 9 servidores, sendo $\rho = \frac{\lambda}{S \mu}$,
temos que $\rho=1.039$ o que é maior que 1, logo a fila cresceria infinitamente.
Para 10 servidores, temos que $\rho=0.9355$, $L=20.639$ clientes no sistema,
e $Lq=11.2841$ clientes na fila, sendo que
a medida que interessa, tempos de espera na fila, $Wq=3.2426$ minutos. Note-se que os valores já estão em minutos.
Para 11 servidores, temos que $\rho=0.8504$, $L=12.2668$ clientes no sistema,
e $Lq=2.912$ clientes na fila, sendo que
a medida que interessa $Wq=0.8368$ minutos. 

Os resultados completos podem ser consultados no Apêndice~\ref{appendix:c2}.

\section{Dimensionamento do serviço de clientes}

Com os dados descritos na anterior secção, podemos concluir que a solução ótima
para o número de caixas até 10 unidades, são 3 servidores, pois tem
o \emph{Wq} mais próximo de 1.5 minutos, e para caixas para mais de 10 unidades
temos que, a solução ótima são 10 servidores porque tem o \emph{Wq} mais próximo
de 3 minutos. Embora o tempo de espera na fila seja de 0.8363 minutos, o $\rho$
ronda os 80\%, que é um valor aceitável.


\section{Pressupostos considerados}

Durante a análise e do problema apresentado, foi pressuposto que nas caixas
normais são atendidos apenas clientes que tragam mais do que 10 unidades de
artigos. Esta suposição tem como objetivo simplificar a resolução deste
problema, pois em situações reais o atendimento a clientes que comprem até 10
unidades de artigos não está limitado ás caixas designadas para tal volume de
compras. 

A partir dos dados gerados para a resolução deste problema, é possível
determinar apenas uma taxa de chegada única, usando os intervalos de tempo entre
duas chegadas consecutivas. Na listagem deste intervalos não existe uma
discriminação entre clientes com compras de mais ou menos 10 unidades de
artigos. Consequentemente, para determinar uma taxa de chegada para cada tipo de
sistema de servidores, seria necessário assumir que uma parte dos intervalos
listados corresponderia a chegadas a uma caixa para menos de 10 unidades,
e a parte restante corresponderia a chegadas a uma caixa normal. Esta separação
poderia ser definida ao determinar a percentagem de clientes que compraram menos
de 10 unidades de artigos, e aplicar este valor à soma dos intervalos de
chegadas, usando o valor correspondente para calcular a taxa de chegada para
caixas de 10 artigos ou menos, e o restante valor para as caixas normais.


Existem outros pressupostos que podem influenciar o modelo, e que não são dados do
problema. Como já mencionado nas primeiras secções, desconhece-se se podem
chegar em grupo ou não. De facto, existem serviços de hipermercado, nos quais
a chegada pode ser em grupo, tal como pessoas de zonas rurais que chegam de
camionetas para ir à compras. Outras assunção, é que a taxa de chegadas
é constante. Ora, esta pode variar consoante dias da semana, bem como em
horários distintos durante o dia. Pode haver influência externa, por exemplo,
o hipermercado fazer parte de um centro comercial, como é o caso de \emph{Pingo
Doce} no \emph{Braga Parque}, e como essa influência influencia o hipermercado.  
Em relação à disciplina das filas, assumiu-se que as filas teriam uma disciplina
do tipo \emph{FIFO}. Note-se no entanto, que pode haver filas prioritárias para
pessoas com deficiência, grávidas, entre outros grupos. Pensa-se que
a disciplina de \emph{pre-emptive} não se aplica, dado que se desconhece
implementação do género.
 
Em relação ao número de filas, dado a taxa de chegada ser única, e de igual
modo, temos dois tipos de caixas, em que não existe um obrigatoriedade de limite
de compras, a assunção de que existem várias filas pode estar errada. A fila
pode ser única.

Outra nuance do problema tem a ver como o facto de clientes serem ou não
atendidos em grupo, i.e.\, existem serviços, tais como compras online, onde são
encomendadas compras e próprio hipermercado pode criar os lotes para entrega, ou
empresas ou particulares que o façam. De igual modo, não é possível saber se
o serviço alguma vez está indisponível, tal como, em feriados como, se fecha ao
fim de semana --- embora os hipermercados conhecidos não o faça, --- ou outro. Da
mesma forma, não é possível saber se a taxa média de serviço é constante, ou se
é variável: pode depender do tipo de mecanismos por caixa, ou simplesmente ter
mais que uma pessoa a atender. 
  
Não se sabe se as filas têm limite de clientes, dependendo da política do
hipermercado.







